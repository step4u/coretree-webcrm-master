<!DOCTYPE html>
<html ng-app="app" id="ng-app">
<head>
	<title>CRM with IPCC - Coretree</title>
  	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
	
    <link rel="stylesheet" href="/resources/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="resources/bootstrap/css/bootstrap-theme.min.css" />
	<script src="resources/bootstrap/js/bootstrap.min.js"></script>
	
	<script src="https://code.angularjs.org/1.4.8/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.4.8/angular-touch.min.js"></script>
    <script src="https://code.angularjs.org/1.4.8/angular-animate.min.js"></script>
    <script src="https://code.angularjs.org/1.4.8/angular-route.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.8/angular-cookies.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.14.3/ui-bootstrap-tpls.min.js"></script>
    <script src="http://angular-ui.github.io/ui-router/release/angular-ui-router.js"></script>

    <script src="resources/angularjs/grid-ui/grunt-scripts/csv.js"></script>
    <script src="resources/angularjs/grid-ui/grunt-scripts/pdfmake.js"></script>
    <script src="resources/angularjs/grid-ui/grunt-scripts/vfs_fonts.js"></script>

	<script src="resources/angularjs/grid-ui/3.0.7/ui-grid.min.js"></script>
    <link rel="stylesheet" href="resources/angularjs/grid-ui/3.0.7/ui-grid.min.css" />
   	<script src="resources/js/BootStrapContextMenu.js"></script>
    
    <link rel="stylesheet" href="resources/css/simple-sidebar.css" />

    <link rel="stylesheet" href="resources/css/main.css" />    
    <link rel="stylesheet" href="style.css" />
    <script src="script1.js"></script>
    <script src="contextmenu.js"></script>
    
    <script src="resources/js/sockjs-0.3.4.js"></script>
    <script src="resources/js/stomp.js"></script>
    
	<style>
    </style>
    
	<script>
	/*
	    (function() {
	        var socket = new SockJS('/webcrm');
	        var stompClient = Stomp.over(socket);
	
	        var appModel = new ApplicationModel(stompClient);
	        ko.applyBindings(appModel);
	
	        appModel.connect();
	        appModel.pushNotification("Trade results take a 2-3 second simulated delay. Notifications will appear.");
		})();
	*/
	
		var ROLE;
		var whoami;
		var stompClient;
	    function connect() {
	        var socket = new SockJS('/webcrm');
	        stompClient = Stomp.over(socket);
	        stompClient.outgoing = 10000;
	        stompClient.incoming = 10000;
	        
	        stompClient.connect({}, function(frame) {
	        	whoami = frame.headers['user-name'];
	            console.log('index.html Connected: ' + frame);

	            /*
	            stompClient.subscribe("/user/topic/callstatus", function(message) {
	            	console.log('index.html /topic/callstatus: ' + JSON.parse(message.body));
	            });
	            */

	            stompClient.subscribe("/topic/ext.status.*", function(message) {
	            	var data = JSON.parse(message.body);
	                console.log("/topic/ext.status : " + data.extension + ", " + data.status);
	            	;
	              });
	            
	            stompClient.subscribe("/user/queue/groupware", function(message) {
	            	// console.log('index.html /user/queus/groupware: ' + JSON.parse(message.body));
	            	// console.log('index.html /user/queus/groupware: ' + message.body);
				});
	            
	            stompClient.subscribe("/user/queue/errors", function(message) {
	            	console.log('index.html /app/queue/errors: ' + JSON.parse(message.body));
				});
	        });
	    }
	    
	    function disconnect() {
	        if (stompClient != null) {
	            stompClient.disconnect();
	        }
	        // setConnected(false);
	        console.log("Disconnected");
	    }
	    
	    function sendName() {
	        var name = document.getElementById('name').value;
	        stompClient.send("/user/hello", {}, JSON.stringify({ 'name': name }));
	    }
		
		$(document).ready(function(){
			$('[data-toggle="tooltip"]').tooltip();
			
			$('a').click(function(event){
				var str = this.toString();
				str = str.split('/#/');
				// alert(str.length);
				if (str.length < 2)
					event.preventDefault();
			});
			
		    $("#menu-toggle").click(function(e) {
		        e.preventDefault();
		        $("#wrapper").toggleClass("toggled");
		    });
		    
		    $("#publicaddr").click(function(e){
		    	e.preventDefault();
		    	console.log('publicaddr clicked');
		    	location.href="addr0";
		    });
		    $("#personaladdr").click(function(e){
		    	e.preventDefault();
		    	console.log('personaladdr clicked');
		    	location.href="addr1";
		    });
		    
		    ROLE = $.cookie("ROLE");

		    // connect();
		});
	</script>
</head>
<body>
    <div id="wrapper">
		<div ui-view="content"></div>
    </div>

<!-- 
    <footer class="footer">
      <div class="container">
        <p class="text-muted">Â© Copyright 2015 Coretree Corp. All Rights Reserved.</p>
      </div>
    </footer>
 -->

	<script src="resources/apps/controller_callstatus.js"></script>
	<script src="resources/apps/controller_telstatus.js"></script>
	<script src="resources/apps/controller_customers.js"></script>
	<script src="resources/apps/controller_calls.js"></script>
</body>
</html>
