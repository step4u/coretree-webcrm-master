<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.coretree.defaultconfig.mapper.MemberMapper">

    <resultMap id="resMap" type="com.coretree.defaultconfig.mapper.Member">
        <id     property="emp_no"			column="emp_no" />
        <result property="password"			column="password" />
        <result property="emp_nm"			column="emp_nm" />
        <result property="grp_cd"			column="grp_cd" />
        <result property="enter_date"		column="enter_date" />
        <result property="auth_cd"			column="auth_cd" />
		<result property="mobile_phoneno"	column="mobile_phoneno" />
		<result property="extension_no"		column="extension_no" />
		<result property="note"				column="note" />
    </resultMap>
    
    <select id="count" resultType="java.lang.Integer">
    	select count(emp_no) from TORGANIZATION
    </select>
    
    <select id="selectAll" resultMap="resMap">
    	select first #{rowsperpage} skip ((#{curpage} - 1) * #{rowsperpage})
			emp_no, emp_nm, grp_cd, mobile_phoneno, extension_no
			from TORGANIZATION
			order by emp_nm asc
    </select>
    
    <select id="selectByIdx" resultMap="resMap">
    	select a.username, a.uname, a.posi, a.tel, a.cellular, a.role, a.state, a.enabled, b.extension
			from users a join users_exts b
				on a.username=b.username
			where a.username=#{username}
    </select>
    
    <select id="selectByExt" resultMap="resMap">
    	select first 1 a.username, a.uname, a.posi, a.tel, a.cellular, b.extension, a.role, a.state, a.enabled
			from users a join users_exts b
				on a.username=b.username
			where b.extension=#{ext}
    </select>
    
    <select id="selectByTxt" resultMap="resMap">
    	select username, uname, posi, tel, extension, role, state, enabled
			from users
			where uname like #{txt}
    </select>
    
    <select id="getUserState" resultMap="resMap">
		select emp_no, emp_nm, grp_cd, enter_date, auth_cd, mobile_phoneno, emailid, extension_no, password, note
			from TORGANIZATION
			order by emp_nm
    </select>
    
    <select id="add" resultType="java.lang.Void">
    	{call INS_MEMBER ( 
    		#{username, mode=IN, jdbcType=VARCHAR},
    		#{password, mode=IN, jdbcType=VARCHAR},
    		#{uname, mode=IN, jdbcType=VARCHAR},
    		#{posi, mode=IN, jdbcType=VARCHAR},
    		#{tel, mode=IN, jdbcType=VARCHAR},
    		#{cellular, mode=IN, jdbcType=VARCHAR},
    		#{extension, mode=IN, jdbcType=VARCHAR}
		)}
    </select>

    <select id="chkById" resultType="java.lang.Integer">
    	select case when count(username) > 0 then 0 else 1 end from users where username=#{username}
    </select>
    
    <select id="del" resultType="java.lang.Void">
    	{call RMV_MEMBER ( #{username, mode=IN, jdbcType=VARCHAR} )}
    </select>
    
    <delete id="delAll" parameterType="java.util.List">
		delete from users where
		<foreach collection="list" item="item" separator=",">
			 username=#{item.username}
		</foreach>
    </delete>
    
    <select id="modi" resultType="java.lang.Void">
		{call UDP_MEMBER (
    		#{username, mode=IN, jdbcType=VARCHAR},
    		#{password, mode=IN, jdbcType=VARCHAR},
    		#{uname, mode=IN, jdbcType=VARCHAR},
    		#{posi, mode=IN, jdbcType=VARCHAR},
    		#{tel, mode=IN, jdbcType=VARCHAR},
    		#{cellular, mode=IN, jdbcType=VARCHAR},
    		#{extension, mode=IN, jdbcType=VARCHAR}
		)}
    </select>
</mapper>
